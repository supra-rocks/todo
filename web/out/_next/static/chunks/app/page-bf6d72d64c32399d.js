(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2016:()=>{},1281:()=>{},8661:(t,e,n)=>{Promise.resolve().then(n.bind(n,1421))},1421:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>q});var a=n(5155),r=n(2115),i=n(4665),l=n(2479),o=n(810),s=n(3592),c=n(6331),d=n(894),u=n(9720),h=n(4448),y=n(3308),g=n(2282),f=n(6854),w=n(4918),p=n(226),x=n(391),S=n(7740),v=n(8187),m=n(6956);n.n(m)().config();let A={DEBUG_MODE:!0,SUPRA_WALLET_PRIVATE_KEY:"0xb55de66b9d7594df4fdbc57f644066d4a06b596defe3866950612070c2ae0218",SUPRA_MOVEVM_TESTNET_RPC:"https://rpc-testnet.supra.com",SUPRA_MOVEVM_TESTNET_RPC_CHAIN_ID:Number("6")||6,SUPRA_MOVEVM_RPC:"https://rpc-mainnet.supra.com",SUPRA_MOVEVM_RPC_CHAIN_ID:Number("8")||8,ADVANCED_TODO_LIST_CONTRACT_ADDRESS:"0xaeb8390d62a7a9a1ad581eb07c481d5b15ea04d2a2ab09aa940ec41a0bfd01a3"};var k=n(457);let b=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),a=1;a<e;a++)n[a-1]=arguments[a];A.DEBUG_MODE&&console.log("DEBUG: ".concat(t),...n)},_=()=>{var t,e;let n=(null===(e=window)||void 0===e?void 0:null===(t=e.starkey)||void 0===t?void 0:t.supra)||null;return b("Getting Starkey provider",{provider:n}),n},j=async()=>{let t=_();if(!t)return b("Starkey provider not found"),window.open("https://starkey.app/","_blank"),null;try{b("Attempting to connect to Starkey");let e=await t.connect();if(b("Starkey connection response",{response:e}),e&&e.length>0)return e[0];return null}catch(t){return b("Error connecting to Starkey",{error:t}),null}},C=async()=>{let t=_();if(t)try{await t.disconnect(),b("Disconnected from Starkey")}catch(t){b("Error disconnecting from Starkey",{error:t})}},T=async()=>{let t=_();if(!t)return null;try{let e=await t.account();return b("Got current account",{accounts:e}),e[0]||null}catch(t){return b("Error getting current account",{error:t}),null}},E=async()=>{let t=_();if(!t)return null;try{let e=await t.balance();return b("Got balance",{balance:e}),e}catch(t){return b("Error getting balance",{error:t}),null}},I=t=>{let e=_();(null==e?void 0:e.on)&&(e.on("accountChanged",t),b("Subscribed to account changes"))},P=t=>{let e=_();(null==e?void 0:e.on)&&(e.on("networkChanged",t),b("Subscribed to network changes"))},R=t=>{let e=_();(null==e?void 0:e.on)&&(e.on("disconnect",t),b("Subscribed to disconnect events"))},D=()=>{let[t,e]=(0,r.useState)(void 0),[n,i]=(0,r.useState)(""),[l,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(!1),[h,y]=(0,r.useState)(!1),w=()=>{_()&&(y(!0),x())},p=async()=>{if(t){let t=await E();t&&i("".concat(t.formattedBalance," ").concat(t.displayUnit))}else i("")},x=async()=>{try{let t=await T();t&&(e(t),await p())}catch(t){b("Error initializing connection",{error:t})}},S=async()=>{u(!0);try{let t=await j();t&&(e(t),await p())}catch(t){b("Error connecting to Starkey",{error:t})}u(!1)},v=async()=>{try{await C(),e(null),i(""),c("")}catch(t){b("Error disconnecting from Starkey",{error:t})}};return((0,r.useEffect)(()=>{w(),I(t=>{t.length>0?(e(t[0]),p()):(e(null),i(""))}),P(t=>{c(t.chainId)}),R(()=>{e(null),i(""),c("")})},[]),!1===h)?(0,a.jsx)(g.A,{color:"primary",variant:"contained",size:"large",onClick:()=>window.open("https://starkey.app/","_blank"),sx:{textTransform:"none"},children:"Install StarKey"}):d?(0,a.jsxs)(s.A,{display:"flex",alignItems:"center",gap:1,children:[(0,a.jsx)(f.A,{size:24}),(0,a.jsx)(o.A,{children:"Connecting..."})]}):(0,a.jsx)(s.A,{children:t?(0,a.jsxs)(s.A,{display:"flex",alignItems:"center",gap:1,children:[(0,a.jsx)(s.A,{display:"flex",alignItems:"center",sx:{bgcolor:"primary.main",minWidth:"64px",minHeight:"42.25px",padding:"8px 22px",borderRadius:"4px"},children:(0,a.jsx)(o.A,{variant:"body1",fontWeight:"bold",fontSize:"0.9375rem",children:(t=>"".concat(t.slice(0,4),"...").concat(t.slice(-4)))(t)})}),(0,a.jsx)(g.A,{color:"secondary",variant:"contained",size:"large",onClick:v,sx:{textTransform:"none"},disableElevation:!0,children:"Disconnect"})]}):(0,a.jsx)(g.A,{color:"primary",variant:"contained",size:"large",onClick:S,sx:{textTransform:"none"},disableElevation:!0,children:"Connect StarKey"})})},z=()=>(0,a.jsx)(s.A,{sx:{position:"absolute",top:16,right:16,display:"flex",alignItems:"center",gap:1},children:(0,a.jsx)(D,{})}),V=t=>{let{children:e}=t;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.Ay,{}),(0,a.jsx)(z,{}),(0,a.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:e})]})},M=()=>(0,a.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:(0,a.jsx)(f.A,{})});var W=n(4092);class N{async getAddress(){b("Getting address from Starkey wallet");let t=await j();if(!t)throw Error("Failed to connect to Starkey wallet");return b("Fetched account address",{address:t}),t}async sendTransaction(t,e,n,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"contractInteraction";if(!this.starkeyProvider)throw Error("Starkey provider is not initialized");b("Preparing transaction",{contractAddress:t,moduleName:e,functionName:n,args:a,transactionType:r});try{let i=await this.starkeyProvider.account();if(!i||0===i.length)throw Error("No account connected");let l=await this.starkeyProvider.getChainId();if(!l)throw Error("Could not get chain ID");if("tokenTransfer"===r){let[t,e]=a,n={from:i[0],to:t,value:e,chainId:l.chainId};b("Sending token transfer",{tx:n});let r=await this.starkeyProvider.sendTransaction(n);return b("Token transfer result",{result:r}),r}{let r=Math.ceil(Date.now()/1e3)+30,o=[i[0],0,t,e,n,[],a.map(t=>"number"==typeof t?W.r8.bcsSerializeUint64(t):W.r8.bcsSerializeStr(t)),{txExpiryTime:r}];b("Creating raw transaction",{rawTxPayload:o});let s={data:await this.starkeyProvider.createRawTransactionData(o),from:i[0],to:t,chainId:l.chainId,value:""};b("Sending contract interaction",{tx:s});let c=await this.starkeyProvider.sendTransaction(s);return b("Contract interaction result",{result:c}),c}}catch(t){throw b("Transaction error",{error:t}),t}}constructor(){if(b("Initializing StarkeyWalletClient"),this.starkeyProvider=_(),!this.starkeyProvider){let t=Error("Starkey wallet not available");throw b("Error during initialization",{error:t}),t}b("Starkey provider initialized",{starkeyProvider:this.starkeyProvider})}}class U{async getAddress(){let t=this.account.address();return b("Fetched account address",{address:t}),t}async invokeViewMethod(t,e,n){b("Invoking view method",{functionFullName:t,typeArgs:e,args:n});let a=await this.client.invokeViewMethod(t,e,n);return b("View method result",{result:a}),a}async sendTransaction(t,e,n,a){b("Preparing to send transaction",{contractAddress:t,moduleName:e,functionName:n,args:a});let r=(await this.client.getAccountInfo(this.account.address())).sequence_number;b("Fetched sequence number",{sequenceNumber:r});let i=a.map(t=>{let e="number"==typeof t?W.r8.bcsSerializeUint64(t):W.r8.bcsSerializeStr(t);return b("Serialized argument",{arg:t,serialized:e}),e}),l=await this.client.createSerializedRawTxObject(this.account.address(),r,t,e,n,[],i);b("Created raw transaction",{tx:l});let o=await this.client.sendTxUsingSerializedRawTransaction(this.account,l,{enableWaitForTransaction:!0});return b("Transaction result",{result:o}),o}constructor(t,e){b("Initializing SupraSDKWalletClient",{client:t,account:e}),this.client=t,this.account=e}}var O=n(5714).Buffer;let F=async()=>{b("Initializing SupraClient for view methods",{rpc:A.SUPRA_MOVEVM_TESTNET_RPC});let t=await W.Tz.init(A.SUPRA_MOVEVM_TESTNET_RPC),e=null;try{e=new N,b("Starkey wallet initialized successfully")}catch(t){b("Starkey wallet unavailable. Fallback to SupraSDK for transactions",{error:t})}return new Proxy({async invokeViewMethod(e,n,a){b("Invoking view method",{functionFullName:e,typeArgs:n,args:a});try{let r=await t.invokeViewMethod(e,n,a);return b("View method result",{result:r}),r}catch(t){b("SupraClient invokeViewMethod not available",{error:t})}},async sendTransaction(n,a,r,i,l){if(b("Preparing to send transaction",{contractAddress:n,moduleName:a,functionName:r,args:i,transactionType:l}),e)return b("Using StarkeyWallet for transaction"),e.sendTransaction(n,a,r,i,l);b("Using SupraSDKWalletClient for transaction (fallback)");let o=new U(t,await K()),s=await o.sendTransaction(n,a,r,i);return b("Transaction result from SupraSDKWalletClient",{result:s}),s},async getAddress(){if(e){b("Fetching address from StarkeyWallet");let t=await e.getAddress();return b("Fetched address from StarkeyWallet",{address:t}),t}b("Fetching address from SupraSDKWalletClient");let t=await K();if(!t)return;let n=t.address().toString();return b("Fetched address from SupraSDKWalletClient",{address:n}),n}},{get(t,e){let n=t[e];return b("Accessing property on WalletClient",{property:e,value:n}),n||void 0}})},K=async()=>{b("Initializing SupraAccount");let{SupraAccount:t}=await Promise.resolve().then(n.bind(n,4092)),{cleanHexString:e}=await n.e(223).then(n.bind(n,2223)),a=e(A.SUPRA_WALLET_PRIVATE_KEY);if(!a){b("SupraAccount could not be initialized without a private key");return}let r=new t(O.from(a,"hex"));return b("Initialized SupraAccount",{address:r.address()}),r},L=()=>{let[t,e]=(0,r.useState)(null),[n,a]=(0,r.useState)(null),[i,l]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{(async()=>{try{let t=await F(),n=await t.getAddress();e(t),a(n)}catch(t){console.error("Failed to initialize wallet:",t)}finally{l(!1)}})()},[]),{walletClient:t,accountAddress:n,loading:i}},G=async(t,e,n)=>{var a;b("Fetching Todo Lists",{contractAddress:e,moduleName:n});let r=await t.getAddress();b("Using account address",{accountAddress:r});let i="".concat(e,"::").concat(n,"::get_todo_list_counter");b("Invoking view method",{functionFullName:i});let l=await t.invokeViewMethod(i,[],[r]);if(b("Raw result from view method",{result:l}),!l)return b("Could not load lists"),[];let o=parseInt(null!==(a=l[0])&&void 0!==a?a:"0",10);b("Parsed counter value",{counter:o});let s=Array.from({length:o},(t,e)=>e);return b("Generated list indexes",{listIndexes:s}),s},B=async(t,e,n,a)=>{b("Loading Todos",{contractAddress:e,moduleName:n,listIdx:a});let r=await t.getAddress();b("Using account address",{accountAddress:r});let i="".concat(e,"::").concat(n,"::get_todo_list");b("Invoking view method for todo list",{functionFullName:i});let l=await t.invokeViewMethod(i,[],[r,a.toString()]);b("Raw response for todo list",{response:l});let o=parseInt(l[1],10);b("Number of todos in list",{todosLength:o});let s=await Promise.all(Array.from({length:o},async(i,l)=>{let o=await t.invokeViewMethod("".concat(e,"::").concat(n,"::get_todo"),[],[r,a.toString(),l.toString()]);return b("Raw response for individual todo",{index:l,todoResponse:o}),{id:l,content:o[0],completed:o[1]}}));return b("Final list of todos",{todos:s}),s},H=async(t,e,n,a,r)=>{b("Preparing transaction",{contractAddress:e,moduleName:n,functionName:a,args:r});let i=await t.sendTransaction(e,n,a,r,"contractInteraction");return b("Transaction result",{result:i}),i},Y=(t,e,n)=>{let[a,i]=(0,r.useState)([]),[l,o]=(0,r.useState)([]),[s,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(!1),h=async()=>{if(t){u(!0);try{let a=await G(t,e,n);i(a),a.length>0&&y(a[0])}finally{u(!1)}}},y=async a=>{if(t){u(!0);try{let r=await B(t,e,n,a);o(r),c(a)}finally{u(!1)}}},g=async()=>{if(t){u(!0);try{await H(t,e,n,"create_todo_list",[]),await h()}finally{u(!1)}}},f=async a=>{if(t&&null!==s){u(!0);try{await H(t,e,n,"create_todo",[s,a]),await y(s)}finally{u(!1)}}},w=async a=>{if(t&&null!==s){u(!0);try{await H(t,e,n,"complete_todo",[s,a]),await y(s)}finally{u(!1)}}};return{todoLists:a,todos:l,currentListIdx:s,loading:d,fetchTodoLists:h,fetchTodos:y,createTodoList:g,addTodo:f,completeTodo:w}},q=()=>{let t=A.ADVANCED_TODO_LIST_CONTRACT_ADDRESS,[e,n]=(0,r.useState)(""),[m,k]=(0,r.useState)(),{walletClient:b,loading:_}=L(),{todoLists:j,todos:C,currentListIdx:T,loading:E,fetchTodoLists:I,fetchTodos:P,createTodoList:R,addTodo:D,completeTodo:z}=Y(b,t,"advanced_todo_list");return((0,r.useEffect)(()=>{(async()=>{b&&(I(),k(await b.getAddress()))})()},[b]),_)?(0,a.jsx)(M,{}):m?(0,a.jsx)(V,{children:(0,a.jsx)(i.A,{variant:"outlined",sx:{width:400,borderRadius:3},children:(0,a.jsxs)(l.A,{children:[(0,a.jsx)(s.A,{sx:{position:"relative"},children:(0,a.jsx)(c.A,{title:"Create new list",children:(0,a.jsx)(d.A,{onClick:R,size:"small",sx:{position:"absolute",top:0,right:0,backgroundColor:"primary.main",color:"white","&:hover":{backgroundColor:"primary.dark"}},children:(0,a.jsx)(S.A,{})})})}),(0,a.jsx)(o.A,{variant:"h5",sx:{fontWeight:600,textAlign:"center",mb:2},children:"To do list"}),j.length>0&&(0,a.jsx)(s.A,{mb:2,children:(0,a.jsx)(u.A,{fullWidth:!0,value:null!=T?T:"",onChange:t=>P(Number(t.target.value)),children:j.map(t=>(0,a.jsxs)(h.A,{value:t,children:["List ",t+1]},t))})}),(0,a.jsxs)(s.A,{display:"flex",gap:1,mb:2,children:[(0,a.jsx)(y.A,{label:"New item",variant:"outlined",fullWidth:!0,value:e,onChange:t=>n(t.target.value),disabled:E}),(0,a.jsx)(g.A,{variant:"contained",onClick:()=>D(e),disabled:!e||E,children:"Add"})]}),E?(0,a.jsx)(s.A,{display:"flex",justifyContent:"center",children:(0,a.jsx)(f.A,{})}):(0,a.jsx)(w.A,{children:C.map(t=>(0,a.jsxs)(p.Ay,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingY:1},children:[(0,a.jsx)(x.A,{primary:t.content,primaryTypographyProps:{fontSize:16,fontWeight:500,color:t.completed?"text.secondary":"text.primary"}}),t.completed?(0,a.jsx)(s.A,{sx:{width:32,height:32,borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,a.jsx)(v.A,{})}):(0,a.jsx)(g.A,{onClick:()=>z(t.id),children:"Mark done"})]},t.id))})]})})}):(0,a.jsx)(V,{children:(0,a.jsx)(i.A,{variant:"outlined",sx:{width:400,borderRadius:3,textAlign:"center"},children:(0,a.jsxs)(l.A,{children:[(0,a.jsx)(o.A,{variant:"h5",sx:{mb:3},children:"Connect Your Wallet"}),(0,a.jsx)(o.A,{variant:"body1",sx:{mb:4,color:"text.secondary"},children:"Please connect your wallet to use this application"})]})})})}}},t=>{var e=e=>t(t.s=e);t.O(0,[644,268,323,981,441,517,358],()=>e(8661)),_N_E=t.O()}]);